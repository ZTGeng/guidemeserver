var user = require('config/models'); 

exports.rate = function(rater_id, ratee_id, rateStr, callback) {
    user.find({token: rater_id}, function(err, users) {
        if (users.length != 0) {
            user.find({token: ratee_id}, function(err, users2) {
                if (users2.length != 0) {
                    var user = users2[0];
                    var rateFloat = parseFloat(rateStr);
                    user.rateTotal += rateFloat;
                    user.rateNum += 1;
                    user.save();
                    callback({'response': "Rating success", 'res': true});
                } else {
                    callback({'response': "Cannot find user being rated", 'res': false});
                }
            });
        } else {
            callback({'response': "Cannot find user while rating", 'res': false});
        }
        
    });
};

exports.getRateFloat = function(token, callback) {
    user.find({token: token}, function(err, users) {
        if (users.length != 0) {
            var rateFloat = Math.round((users[0].rateTotal / users[0].rateNum) * 10) / 10;
            callback({'rate': rateFloat, 'res': true});
        } else {
            callback({'response': "Error while getting rate", 'res': false});
        }
    });
};